jQuery(function($){if($('.lightbox').length>0){$('.lightbox').magnificPopup({type:'image'});$('.entry-content p .lightbox').each(function(){$(this).css('float',$(this).children('img').css('float'));});}
var header_top=$("#masthead .top-duft-punk").height();function fixHeader(){var y=$(window).scrollTop();var header=$('#masthead .bluth-navigation');if(y>header_top){header.addClass('fixed');}else{header.removeClass('fixed');}
if(y>(header.height()+ 100)){header.addClass('shrunk');}else{header.removeClass('shrunk');}}
fixHeader();var didScroll=false;$(window).scroll(function(){didScroll=true;});setInterval(function(){if(didScroll&&jQuery(window).width()>979){didScroll=false;fixHeader();}},50);var videos_scroll_locked=false;var videos_box=$('.videos-box')
var videos_margin=parseInt(videos_box.css('paddingLeft'));var videos_ellipsis_width=$('.videos-ellipsis').length?$('.videos-ellipsis').width()+ videos_margin:0;function videos_scroll_width(){var videos_count=$('.video').length;var video_width=$('.video').width()+ videos_margin;return video_width*videos_count+ videos_ellipsis_width;}
function show_videos_sliders(){var videos_scroll=$('.videos-scroll');var videos_box=$('.videos-box');if(videos_scroll.position().left<videos_margin)videos_box.addClass('slide-left');else videos_box.removeClass('slide-left');if(videos_scroll.position().left+ videos_scroll_width()>videos_box.width()+ videos_margin*2)videos_box.addClass('slide-right');else videos_box.removeClass('slide-right');videos_scroll_locked=false;}
if(videos_box.length){show_videos_sliders();var videos_box_width=videos_box.width();var resizeTimer;$(window).on('resize',function(e){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){if(videos_box.width()!=videos_box_width){videos_box_width=videos_box.width();show_videos_sliders();}},250);});$('.videos-right').click(function(){if(!videos_scroll_locked){videos_scroll_locked=true;var videos_scroll=$('.videos-scroll');var video_width=$('.video').width()+ videos_margin;var delta=((videos_box_width/(video_width))>>0)*video_width;if(videos_scroll.position().left- delta+ videos_scroll_width()<videos_box.width()+ videos_margin*2)delta=videos_scroll.position().left+ videos_scroll_width()- videos_box.width()- videos_margin*2;videos_scroll.animate({left:"-="+ delta},350,"swing",function(){show_videos_sliders();});}});$('.videos-left').click(function(){if(!videos_scroll_locked){videos_scroll_locked=true;var videos_scroll=$('.videos-scroll');var video_width=$('.video').width()+ videos_margin;var delta=((videos_box_width/(video_width))>>0)*video_width;if(videos_scroll.position().left+ delta>videos_margin)delta=videos_margin- videos_scroll.position().left;videos_scroll.animate({left:"+="+ delta},350,"swing",function(){show_videos_sliders();});}});}
function updateQueryStringParameter(uri,key,value){var re=new RegExp("([?&])"+ key+"=.*?(&|$)","i");var separator=uri.indexOf('?')!==-1?"&":"?";if(uri.match(re)){return uri.replace(re,'$1'+ key+"="+ value+'$2');}
else{return uri+ separator+ key+"="+ value;}}
$(document).keydown(function(e){if(e.keyCode==88&&e.ctrlKey&&e.shiftKey&&!window.location.href.includes('cache=no')){window.location.replace(updateQueryStringParameter(window.location.href,'cache','no'));}else
if(e.keyCode==90&&e.ctrlKey&&e.shiftKey){var postId=parseInt(jQuery('div#content > article.post').attr('id').replace('post-',''));if(postId>0)window.location.assign('https://'+ window.location.hostname+'/wp-admin/post.php?post='+ postId+'&action=edit');}});function barrel_roll(el){$(el).addClass('barrel_roll');setTimeout(function(){$(el).removeClass('barrel_roll');},3000);}
$('#logo').click(function(){barrel_roll(this);})
$('#logo').dblclick(function(){alert('TkFETyBCWUxPIFNUQVZJVCcgTElOVVgh=');});$('.news-show-all').click(function(){$('.news-hidden').fadeIn();var tag_slug=$('.news-show-all').attr('tag');var button_href='/category/news/';var button_name='Все новости';if(tag_slug){button_href+='?tag='+ tag_slug;button_name+=' по теме';}
var news_show_all_a=$('<a>').attr('href',button_href).html(button_name+' <span class="dashicons dashicons-arrow-right-alt2 vertical-middle"></span>');if(tag_slug)news_show_all_a.attr('rel','nofollow');$('.news-show-all').text('').append(news_show_all_a);$('.news-show-all').unbind('click');});$('.show_more_tags').click(function(){$('.show_more_tags, .feed_switcher_wrapper').hide();$('.nav-collapse > ul').addClass('space_for_more_link');$('.show_all_tags').show();return false;});var searchbox_is_open=false;function toggleSearchbox(e){e.preventDefault();searchbox_is_open=(searchbox_is_open?false:true);$(searchbox).toggle();$(searchbox).find('input').focus();$(main).toggleClass('unfocused');$('.bluth-navigation').toggleClass('unfocused');$(eventfrozen).toggle();}
$(document).click(function(e){if($(e.target).parents('#search_icon').length!=0||e.target.id==search_icon.id||(searchbox_is_open&&($(e.target).parents('#searchbox').length==0&&$(e.target).parents('#search_icon').length!=0))){toggleSearchbox(e);}})
$(eventfrozen).click(toggleSearchbox);$('.header_searchbox_input_cancel').click(toggleSearchbox);var searchbox_hide_scroll_offset=5;var searchbox_scroll_pos=-1;$(document).scroll(function(e){if(searchbox_is_open){var current_scroll_pos=$(window).scrollTop();if(searchbox_scroll_pos<0)searchbox_scroll_pos=current_scroll_pos;if(Math.abs(searchbox_scroll_pos- current_scroll_pos)>searchbox_hide_scroll_offset){toggleSearchbox(e);}}else{searchbox_scroll_pos=-1;}});$(document).keyup(function(e){if(e.keyCode==27&&searchbox_is_open){toggleSearchbox(e);}});$('.tmenu').clone().attr('id','tmenu_collapse').insertAfter('#masthead > div.row-fluid.top-duft-punk > div');$('#expand_icon').click(function(){$('#tmenu_collapse').slideToggle();})
$(".first").click(function(){if($(".second").hasClass("on"),$(".tumbler").hasClass("on")){$(".second").removeClass("on"),$(".tumbler").removeClass("on"),$(".first").addClass("on");}
return false;});$(".second").click(function(){if($(".first").hasClass('on')){$(".first").removeClass('on'),$(".second").addClass('on'),$(".tumbler").addClass('on');window.location='/top/week/';}
return false;});$(".tumbler").click(function(){if($(".tumbler").hasClass('on'),$(".second").hasClass('on')){$(".tumbler").removeClass('on'),$(".second").removeClass('on'),$(".first").addClass('on');window.location='/';}else{$(".tumbler").addClass('on'),$(".first").removeClass('on'),$(".second").addClass('on');window.location='/top/week/'}
return false;});var current_top_period;if(window.location.pathname.match('top\/([a-zA-Z]+)')!=null){current_top_period=window.location.pathname.match('top\/([a-zA-Z]+)')[1];$('#feed_mode_select').find('option[value="'+ current_top_period+'"]').attr('selected','selected');$(".tumbler").addClass('on');$(".first").removeClass('on');$(".second").addClass('on');}else{current_top_period='week';}
$('#feed_mode_select').change(function(e){var period=$(this).find('option:selected').val();if(period!=current_top_period){window.location='/top/'+ period+'/';}});$(loading_switcher).hide();$('.switcher_content').show();$('.show_more_tags').addClass('display_show_more_tags');function get_google_ad_size(adWidth,isBetweenPosts){if(isBetweenPosts){if(window.innerWidth>=979){return[280,280];}}
if(adWidth>=728){google_ad_size=["728","90"];/!* Leaderboard 728x90 *!/}else if(adWidth>=468){google_ad_size=["468","60"];/!* Banner (468 x 60) *!/}else if(adWidth>=336){google_ad_size=["336","280"];/!* Large Rectangle (336 x 280) *!/}else if(adWidth>=300){google_ad_size=["300","250"];/!* Medium Rectangle (300 x 250) *!/}else if(adWidth>=250){google_ad_size=["250","250"];/!* Square (250 x 250) *!/}else if(adWidth>=200){google_ad_size=["200","200"];/!* Small Square (200 x 200) *!/}else if(adWidth>=180){google_ad_size=["180","150"];/!* Small Rectangle (180 x 150) *!/}else{google_ad_size=["125","125"];}
return google_ad_size;}
var didScroll2,normalLayout=false;if(!$('#content').hasClass('twocolumn')&&!$('#content').hasClass('threecolumn')&&!$('#content').hasClass('fourcolumn')&&!$('#content').hasClass('fivecolumn')){normalLayout=true;didScroll2=false;}else{didScroll2=true;}
$(window).scroll(function(){didScroll2=true;});setInterval(function(){if(didScroll2){didScroll2=false;y2=$(window).scrollTop();if($('.facebook-store').length>0){$('.facebook-store').each(function(e){if((y2>$(this).offset().top- 800&&y2<$(this).offset().top+ 200)&&!$(this).data('loaded')){$(this).data('loaded','1');console.log('thewidth: '+ $(this).width());$(this).html($(this).data('code'));FB.XFBML.parse($(this).get(0));if(!normalLayout){$(this).html('<a class="facebook-fallback" href="'+$(this).find('.fb-post').data('href')+'"><i class="icon-facebook-1"></i></a>');}}});}
if($('.twitter-store').length>0){$('.twitter-store').each(function(e){if((y2>$(this).offset().top- 800&&y2<$(this).offset().top+ 200)&&!$(this).data('loaded')){$(this).data('loaded','1');$(this).html($(this).data('code'));twttr.widgets.load();}});}
if($('.google-store').length>0){$('.google-store').each(function(e){if((y2>$(this).offset().top- 800&&y2<$(this).offset().top+ 200)&&!$(this).data('loaded')){$(this).data('loaded','1');$(this).html($(this).data('code'));gapi.follow.go();}});}}},600);$('.bl_newsletter button').click(function(){var that=$(this);that.addClass('disabled');var email=that.parent().find('.bl_newsletter_email').val();if(typeof email=='undefined'){$('body').prepend('<div class="bl_alert"><h4 style="text-align:center"><i class="icon-cancel-circle"></i>&nbsp;no email</h4></div>');$('.bl_alert').slideDown().delay(3000).slideUp();that.removeClass('disabled');return false;}
$.post(blu.ajaxurl,{email:email,action:'blu_ajax_mailchimp',list:that.attr('data-list')},function(output){output=$.trim(output);var obj=$.parseJSON(output);if(obj.error){$('body').prepend('<div class="bl_alert"><h4 style="text-align:center"><i class="icon-cancel-circle"></i>&nbsp;'+obj.error+'</h4></div>');$('.bl_alert').slideDown().delay(3000).slideUp();}else if(obj.status=='ok'){$('body').prepend('<div class="bl_alert"><h4 style="text-align:center"><i class="icon-ok-circle"></i>&nbsp;'+blu.locale.thank_you_for_subscribing+'</h4></div>');$('.bl_alert').slideDown().delay(3000).slideUp();}});that.removeClass('disabled');that.closest('.input-group').find('input').val('');return false;});if($(".entry-video iframe").length>0){if(!$('#content').hasClass('margin')){var v_container=$("#content article");}else{var v_container=$("#content");}
var video=$(".entry-video iframe");var width=16;var height=9;video.attr('data-aspectRatio',height/width).removeAttr('height').removeAttr('width');function fixRatio(){var newWidth=v_container.width();video.width(newWidth).height(newWidth*video.attr('data-aspectRatio'));if($('#content').hasClass('twocolumn')||$('#content').hasClass('threecolumn')||$('#content').hasClass('fourcolumn')||$('#content').hasClass('fivecolumn')){$('#content .columns').masonry();}}
fixRatio();var resizeTimer;$(window).on('resize',function(e){clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){fixRatio();},250);});}
$('.share-post').click(function(e){e.preventDefault();});var oldTop;$('.entry-video > iframe').mouseover(function(){$(this).closest('article').find('.post-format-badge').stop();$(this).closest('article').find('.post-format-badge').animate({opacity:'0'},500,'swing');});$('.entry-video > iframe').mouseout(function(){$(this).closest('article').find('.post-format-badge').stop();$(this).closest('article').find('.post-format-badge').animate({opacity:'1'},500,'swing');});$('time.timeago').timeago();$('.tips').tooltip();$('.bl_popover').popover();$('.format-quote .quote-area').each(function(e){var width=$(this).width();if(width<410){width=410;}
$(this).find('.quote-text').css('font-size',(width/16)+'px');var height=$(this).height();$(this).height(height);$(this).css('margin-top','-'+($(this).height()/2)+'px');
$(this).css('opacity','1');});if($('.bl_featured_post').length>0){slidesPerView=1;$('.swiper-container-featured').each(function(e){$swiper=$(this);$(this).swiper({loop:true,paginationClickable:true,slidesPerView:slidesPerView,onTouchEnd:function(element){$('.swiper-container').removeClass('active');},onTouchStart:function(element){$('.swiper-container').addClass('active');},onSlideChangeEnd:function(element){$('.swiper-container').removeClass('active');},calculateHeight:true,});$('.swiper-container-featured .arrow-left').on('click',function(e){e.preventDefault();$(this).closest('.swiper-container-featured').swiper().swipePrev();});$('.swiper-container-featured .arrow-right').on('click',function(e){e.preventDefault();$(this).closest('.swiper-container-featured').swiper().swipeNext();});$('.swiper-container-featured .swiper-slide a').each(function(e){var width=$(this).find('.post-title').width();if(width<410){width=410;}
if(width>1000){width=1000;}
$(this).find('.post-title').css('font-size',(width/15)+'px');if($(this).closest('#above-blog').length>0){$(this).find('.post-title p').css('font-size',(width/35)+'px');}else{$(this).find('.post-title p').css('font-size',(width/25)+'px');}
var height=$(this).height();$(this).height(height);$(this).find('.post-title').css('margin-top','-'+($(this).find('.post-title').height()/2)+'px');
$(this).find('.post-title').css('opacity','1');});});}
suffixjpg='.jpg';suffixjpeg='.jpeg';suffixpng='.png';suffixgif='.gif';if($('.gallery').length>0){if($('.gallery-item a').eq(0).attr('href').indexOf(suffixjpg,$('.gallery-item a').eq(0).length- suffixjpg.length)!==-1||$('.gallery-item a').eq(0).attr('href').indexOf(suffixjpeg,$('.gallery-item a').eq(0).length- suffixjpeg.length)!==-1||$('.gallery-item a').eq(0).attr('href').indexOf(suffixpng,$('.gallery-item a').eq(0).length- suffixpng.length)!==-1||$('.gallery-item a').eq(0).attr('href').indexOf(suffixgif,$('.gallery-item a').eq(0).length- suffixgif.length)!==-1){$('.gallery').magnificPopup({delegate:'.gallery-item a',type:'image',gallery:{enabled:true}});}}
if($('.tiled-gallery').length>0){if($('.tiled-gallery-item a').eq(0).attr('href').indexOf(suffixjpg,$('.tiled-gallery-item a').eq(0).length- suffixjpg.length)!==-1||$('.tiled-gallery-item a').eq(0).attr('href').indexOf(suffixjpeg,$('.tiled-gallery-item a').eq(0).length- suffixjpeg.length)!==-1||$('.tiled-gallery-item a').eq(0).attr('href').indexOf(suffixpng,$('.tiled-gallery-item a').eq(0).length- suffixpng.length)!==-1||$('.tiled-gallery-item a').eq(0).attr('href').indexOf(suffixgif,$('.tiled-gallery-item a').eq(0).length- suffixgif.length)!==-1){$('.tiled-gallery').magnificPopup({delegate:'.tiled-gallery-item a',type:'image',gallery:{enabled:true}});}}
$("pre.html").snippet("html",{style:"emacs"});$("pre.css").snippet("css",{style:"emacs"});$("pre.php").snippet("php",{style:"emacs"});$("pre.js").snippet("javascript",{style:"emacs"});$('.page #content article .the-content').animate({opacity:1},1000);$('.nivo-slider').nivoSlider({effect:'fade',slices:15,boxCols:8,boxRows:4,animSpeed:350,pauseTime:8000,startSlide:0,directionNav:true,controlNav:false,controlNavThumbs:false,pauseOnHover:true,manualAdvance:true,randomStart:false,prevText:'<i class="icon-left-open-1"></i>',nextText:'<i class="icon-right-open-1"></i>',beforeChange:function(){},afterChange:function(){},slideshowEnd:function(){},lastSlide:function(){},afterLoad:function(){}});$('.adsbygoogle').each(function(){var isBetweenPosts=$(this).data('betweenposts');adWidth=$(this).parent().width();google_ad_size=get_google_ad_size(adWidth,isBetweenPosts);if(isBetweenPosts&&window.innerWidth>=979){this.parentElement.style.width=google_ad_size[0]+'px';}
$(this).attr('style','display:inline-block;width:'
+ google_ad_size[0]+'px;height:'
+ google_ad_size[1]+'px');$(this.parentNode).data('gastatus','loaded');(adsbygoogle=window.adsbygoogle||[]).push({});});});function social_share(data){var w=760;var h=450;var goal='';if(data.indexOf('vk.com')!==-1){goal='VK_SHARE';w=650;h=584;}else
if(data.indexOf('facebook.com')!==-1){goal='FB_SHARE';w=744;h=397;}else
if(data.indexOf('twitter.com')!==-1){goal='TW_SHARE';w=687;h=253;}else
if(data.indexOf('plus.google.com')!==-1){goal='GP_SHARE';w=407;h=438;}else
if(data.indexOf('ok.ru')!==-1){goal='OK_SHARE';w=600;h=435;}else
if(data.indexOf('pinterest.com')!==-1){goal='PT_SHARE';}else
if(data.indexOf('getpocket.com')!==-1){goal='PK_SHARE';w=558;h=284;}else
if(data.indexOf('mailto:')!==-1)goal='EM_SHARE';if(goal!==''){if(yaCounter27485085!=undefined)yaCounter27485085.reachGoal(goal);if(ga!=undefined)ga('send','event','share','click',goal);}
var dualScreenLeft=window.screenLeft!=undefined?window.screenLeft:screen.left;var dualScreenTop=window.screenTop!=undefined?window.screenTop:screen.top;var width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var left=((width/2)-(w/2))+ dualScreenLeft;var top=((height/2)-(h/2))+ dualScreenTop;var newWindow=window.open(data,"fbshare","height="+ h+",width="+ w+",top="+ top+",left="+ left+",resizable=0,toolbar=0,menubar=0,status=0,location=0,scrollbars=0");if(window.focus){newWindow.focus();}}
try{(function($){$(window).load(function(){function appendDescriptionsToCardTitles($){if(window.innerWidth>=979){var testHeading=$('.main-page .post').last().find('.entry-title-heading');setTimeout(function(){$('.main-page .post').each(function(i,post){var title=$(post).find('.entry-title a');var titleHeading=$(title).find('.entry-title-heading');var entryContent=$(post).find('.entry-content');var description=$(entryContent).text().replace("Читать дальше","");var titleHeadingTextNodeHeight=getTextNodeHeight($(titleHeading).contents()[0]);$(title).css('max-height',$(title).outerHeight());var titleDescription=$('<div/>',{text:description,class:'entry-title-description text-font'}).hide(0);if(($(title).height()- titleHeadingTextNodeHeight)>=(16+ 10)){title.find('.entry-title-description').remove();titleDescription.appendTo(title);$(title).css('flex-flow','column');$(titleHeading).css('display','inline-block');$(titleHeading).height();setTimeout(function(){$(titleDescription).show(0);},0);}});},0);}
function getTextNodeHeight(textNode){var height=0;if(document.createRange){var range=document.createRange();range.selectNodeContents(textNode);if(range.getBoundingClientRect){var rect=range.getBoundingClientRect();if(rect){height=rect.bottom- rect.top;}}}
return height;}}
if($('.main-page .post').length>0)appendDescriptionsToCardTitles($);});})(jQuery);}catch(err){console.log('Title Description Exception: ',err);};(function($){function getTagsList(classList,tagPrefix){var tags=[];$.each(classList,function(index,item){if(item.startsWith('tag-')){tags.push(tagPrefix+item);}});return tags;}
function sendTags(newTags,checkPostsKey,postId){if(newTags.length>0){OneSignal.push(["getTags",function(tags){var tagsToSend={};if(checkPostsKey&&postId>0){var postIds=[];if(typeof tags[checkPostsKey]==='string'){var postIds=tags[checkPostsKey].split(',');if($.inArray(postId.toString(),postIds)!=-1)return;}
postIds.push(postId);tagsToSend[checkPostsKey]=postIds.join();}
$.each(newTags,function(index,newTag){if(newTag in tags){tagsToSend[newTag]=parseInt(tags[newTag])+1;}else{tagsToSend[newTag]=1;}});OneSignal.sendTags(tagsToSend,function(tagsSent){});}]);}}
function getArticleTagsAndSend(tagPrefix,checkPostsKey){var articleElem=$('div#content > article.post');if(typeof OneSignal!=='undefined'&&articleElem.length>0){var postId=parseInt(articleElem.attr('id').replace('post-',''));var classList=articleElem.attr('class').split(/\s+/);var viewTags=getTagsList(classList,tagPrefix);sendTags(viewTags,checkPostsKey,postId);}}
function checkArticleRead(){if(($('html').scrollTop()||$('body').scrollTop())+$(window).height()>articleEndElem.offset().top){window.removeEventListener('scroll',checkArticleRead);getArticleTagsAndSend('read-','posts-read');}}
function setArticleReadChecker(){window.addEventListener('scroll',checkArticleRead);checkArticleRead();}
getArticleTagsAndSend('view-');function sendArticleVisited(){getArticleTagsAndSend('visit-','posts-visited');}
setTimeout(sendArticleVisited,7*1000);var articleEndElem=$('#article-end-beacon');if(articleEndElem.length)setTimeout(setArticleReadChecker,30*1000);})(jQuery);;jQuery(document).ready(function($){var quote_block=$('[data-role="widget_quote_text"]');var quote_button=$('[data-role="widget_get_new_quote"]');function showNewQuote(insert_into){var request=$.ajax({url:"/wp-content/plugins/citation-widget/getQuotes.php",dataType:"text",cache:false});request.done(function(msg){$(insert_into).text(msg);});request.fail(function(jqXHR,textStatus){console.log('Не могу загрузить цитату :( ');});}
quote_button.click(function(event){event.stopPropagation();showNewQuote(quote_block);});showNewQuote(quote_block);});