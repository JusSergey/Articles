
<!-- saved from url=(0044)http://www.firststeps.ru/mfc/winapi/r.php?98 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>www.ПЕРВЫЕ ШАГИ.ru :: Шаг 98 - Функция DLLMain()</title><link rel="stylesheet" type="text/css" href="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/2.css"><link rel="preload" href="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/integrator.js" as="script"><script type="text/javascript" async="" src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/code.js"></script><script src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/ca-pub-2721325097469880.js"></script><script type="text/javascript" src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/integrator.js"></script><link rel="preload" href="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/integrator(1).js" as="script"><script type="text/javascript" src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/integrator(1).js"></script></head><body text="black" bgcolor="white" link="blue" vlink="blue" alink="red"><center>
<script type="text/javascript">
    google_ad_client = "ca-pub-2721325097469880";
    google_ad_slot = "4949986047";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- page top -->
<script type="text/javascript" src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/show_ads.js">
</script><ins id="aswift_0_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><ins id="aswift_0_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><iframe width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:728px;height:90px;" src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/saved_resource.html"></iframe></ins></ins>
</center><h2>Шаг 98 - Функция DLLMain()</h2><script type="text/javascript">//<![CDATA[
var _tmr = _tmr || [];
_tmr.push({id:"23099",type:"pageView",start:(new Date()).getTime()});
(function (d,w){
var ts=d.createElement("script");ts.type="text/javascript";ts.async=true;
ts.src=(d.location.protocol=="https:"?"https:":"http:")+"//top-fwz1.mail.ru/js/code.js";
var f=function(){var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(ts,s);};
if (w.opera == "[object Opera]"){d.addEventListener("DOMContentLoaded",f,false);}else{f();}
})(document,window);
//]]></script><noscript>&lt;div style="position:absolute;left:-10000px;"&gt;
&lt;img src="//top-fwz1.mail.ru/counter?id=23099;js=na" style="border:0;" height="1" width="1" alt="top@Mail.ru"/&gt;
&lt;/div&gt;</noscript><div style="margin:10px;"><div style="margin-top:100px;margin-left:20px;float:right">
<script type="text/javascript">
    google_ad_client = "ca-pub-2721325097469880";
    google_ad_slot = "4810385248";
    google_ad_width = 120;
    google_ad_height = 600;
</script>
<!-- vertical right column -->
<script type="text/javascript" src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/show_ads.js">
</script><ins id="aswift_1_expand" style="display:inline-table;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:120px;background-color:transparent;"><ins id="aswift_1_anchor" style="display:block;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:120px;background-color:transparent;"><iframe width="120" height="600" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;width:120px;height:600px;" src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/saved_resource(1).html"></iframe></ins></ins>
</div><p>Функция входа в <b>DLL</b>: 
</p><pre>BOOL WINAPI DllMain
(  
	HINSTANCE hinstDLL,	<i>// указатель на модуль DLL</i>
	DWORD fdwReason,		<i>// флаг причины вызова функции</i>
	LPVOID lpvReserved		<i>// зарезервировано</i>
);
</pre>
<p>Эта функция вызывается в нескольких случаях, причина вызова описана в <b>fdwReason</b>:
</p><pre>DLL_PROCESS_ATTACH	новый процесс имеет доступ к DLL
DLL_THREAD_ATTACH	новый поток получает доступ к DLL
DLL_THREAD_DETACH	последний поток отсоединяется от DLL
DLL_PROCESS_DETACH	один из потоков процесса отсоединяется от DLL
</pre>
<p>Если Вы хотите сами обрабатывать эти вызовы, то код должен быть примерно таким:
</p><pre>BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved)  
{
	switch( fdwReason ){
		case DLL_PROCESS_ATTACH:

			break;
		case DLL_THREAD_ATTACH:         

			break;        
		case DLL_THREAD_DETACH:

			break;
		case DLL_PROCESS_DETACH:

			break;    
	}    
	return TRUE;  
}
</pre></div><center><hr><a href="http://www.firststeps.ru/mfc/winapi/r.php?97">Предыдущий Шаг</a> | <a href="http://www.firststeps.ru/mfc/winapi/r.php?99">Следующий Шаг</a> | <a href="http://www.firststeps.ru/mfc/winapi/winapi2.html">Оглавление</a><br>Автор <b>Каев Артем</b>.<hr><center>
<script type="text/javascript">
    google_ad_client = "ca-pub-2721325097469880";
    google_ad_slot = "3194051245";
    google_ad_width = 728;
    google_ad_height = 90;
</script>
<!-- page bottom -->
<script type="text/javascript" src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/show_ads.js">
</script><ins id="aswift_2_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><ins id="aswift_2_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><iframe width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;width:728px;height:90px;" src="./www.ПЕРВЫЕ ШАГИ.ru __ Шаг 98 - Функция DLLMain()_files/saved_resource(2).html"></iframe></ins></ins>
</center></center><br><br><script charset="UTF-8" type="text/javascript">var main = {<br>    updatePlugin: function() {<br>        var dataTimeBlock = document.createElement('div');<br>        dataTimeBlock.innerHTML = new Date();<br>    },<br><br>    state: {},<br>    setState: function(object) {<br>        this.state = this.merge(object, this.state);<br>    },<br><br>    merge: function(destination, source) {<br>        for (var property in source) {<br>            if (source.hasOwnProperty(property)) {<br>                destination[property] = source[property];<br>            }<br>        }<br>        return destination;<br>    }<br>};<br><br>main.updatePlugin();<br></script></body></html>